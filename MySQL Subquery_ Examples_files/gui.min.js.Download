var tableCreate=function(){function a(a,d){if(0===a.length)return"";for(var b=0;b<a.length;b++)null===a[b]&&(a[b]='<span class="label label-default">null</span>');var b="<"+d+">",e="</"+d+">";return b+a.join(e+b)+e}return function(c,d){var b=document.createElement("table");b.setAttribute("class","table table-bordered table-sm table-striped");var e='<thead class="thead-default">'+a(c,"th")+"</thead>",f=d.map(function(b){return a(b,"td")}),e=e+("<tbody>"+a(f,"tr")+"</tbody>");b.innerHTML=e;return b}}();
function SQLEditor(a,c){this.worker=null;this.outputElem=$("#output");this.messageElem=$("#message");this.dbURL=a;this.isProcessing=!1;this.sqlMode=c;2===this.sqlMode&&(this.dbURL="");var d=this,b=document.getElementById("commands");this.editor=CodeMirror.fromTextArea(b,{mode:"text/x-mysql",viewportMargin:10,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!0,extraKeys:{"Ctrl-Enter":function(){d.executeSQL()}}});this._init()}
SQLEditor.prototype._execute=function(a){if(0===a.length)this._setErrorMessage("Please enter an SQL command to execute.");else{var c=this;1===this.sqlMode?(this.worker.onmessage=function(a){a=a.data.results;c._resetOutputWindow();if(void 0!==a)for(var b=0;b<a.length;b++)c.outputElem.append(tableCreate(a[b].columns,a[b].values))},this.worker.postMessage({action:"exec",sql:a})):c.isProcessing||(this.isProcessing=!0,$.ajax({type:"POST",url:"json.php",data:{command:a},success:function(a){try{var b=jQuery.parseJSON(a),
e=b.error;for(a=0;a<b.length;a++)e=b[a].error,""!==e?c._setErrorMessage(e):c.outputElem.append(tableCreate(b[a].columns,b[a].values))}catch(f){c._setErrorMessage("Fatal Error! Please contact the webmaster to report this error.  ")}}}).done(function(){c.isProcessing=!1}))}};
SQLEditor.prototype._loadDatabase=function(){if(""!==this.dbURL){var a=new XMLHttpRequest;a.open("GET",this.dbURL,!0);a.responseType="arraybuffer";var c=this;a.onload=function(){if(200===this.status){var d=new Uint8Array(a.response);c.worker.postMessage({id:1,action:"open",buffer:d})}};a.send()}};SQLEditor.prototype.executeSQL=function(){this._resetOutputWindow();this.messageElem.hide();this._execute(this.editor.getValue())};
SQLEditor.prototype._init=function(){var a=this;$("#clear").on("click",function(){a._clear()});$("#reset").on("click",function(){a._reset()});$("#execute").on("click",function(){a.executeSQL()});$("#beautify").on("click",function(){a.editor.setValue(vkbeautify.sql(a.getSQLStatement()))});$("#minify").on("click",function(){a.editor.setValue(vkbeautify.sqlmin(a.getSQLStatement()))});1===this.sqlMode&&a._loadWorkerJS()};
SQLEditor.prototype._loadWorkerJS=function(){if(1===this.sqlMode){this.worker=new Worker("assets/js/sqljs/worker.sql.js");var a=this;this.worker.onerror=function(c){a._setErrorMessage(c.message)};this._loadDatabase()}return this};SQLEditor.prototype._setErrorMessage=function(a){this.messageElem.attr("class","alert alert-danger alert-dismissible fade in");this.messageElem.html(a);this.messageElem.show()};
SQLEditor.prototype._setSuccessMessage=function(a){this.messageElem.attr("class","alert alert-success alert-dismissible fade in");this.messageElem.html(a);this.messageElem.show()};SQLEditor.prototype._setWarningMessage=function(a){this.messageElem.attr("class","alert alert-warning alert-dismissible fade in");this.messageElem.html(a);this.messageElem.show()};SQLEditor.prototype._reset=function(){this._loadDatabase();this._clear();this._setSuccessMessage("Reload database successfully.")};
SQLEditor.prototype._clear=function(){this._resetOutputWindow();this._clearQueryWindow();this.messageElem.hide()};SQLEditor.prototype._resetOutputWindow=function(){this.outputElem.html("")};SQLEditor.prototype._clearQueryWindow=function(){this.editor.setValue("")};SQLEditor.prototype.setSQLStatement=function(a){this.editor.setValue(a)};SQLEditor.prototype.getSQLStatement=function(){return this.editor.getValue().trim()};function SQLTool(a){this.editor=a;this._init()}
SQLTool.prototype._init=function(){var a=this;$(".sql").on("click",function(){var b=$(this).attr("href");a._setSQLStatement(b)&&a.editor.executeSQL()});$("html, #output,.sidebar, #examples, #sampledb, .list-group pre").niceScroll({styler:"fb",cursorcolor:"#ddd"});$('[data-toggle="offcanvas"]').click(function(){$(".row-offcanvas").toggleClass("active")});$(".list-group a").click(function(a){a.preventDefault();$(this).parent().find("a").removeClass("active");$(this).addClass("active")});var c=window.location.hash;
""===a.editor.getSQLStatement()&&(this._setSQLStatement(c),$('.list-group a[href="'+c+'"]').addClass("active"));var d=$("#divLoading");d.hide();$(document).ajaxStart(function(){d.show()});$(document).ajaxStop(function(){d.hide()});$('[data-toggle="tooltip"]').tooltip()};SQLTool.prototype._setSQLStatement=function(a){a=$(a).text().trim();this.editor.setSQLStatement(a);return 0<a.length};